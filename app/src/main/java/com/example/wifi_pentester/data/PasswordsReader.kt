package com.example.wifi_pentester.data

import com.jaredrummler.android.shell.Shell
import java.util.*
import java.util.regex.Pattern

class PasswordsReader {
    val passwords: List<Password>
        get() {
            val passwords: MutableList<Password> = ArrayList()
            val text = readPassword()
            val network = Pattern.compile("(?<=network=\\{\n)((.+)\n)+(?=\\})")
            val nameAbdPass = Pattern.compile("(?<=(ssid|psk)=\")(.+)+(?=\")")
            val matchNetwork = network.matcher(text)
            while (matchNetwork.find()) {
                val matchNameAbdPass = nameAbdPass.matcher(matchNetwork.group())
                val buff: MutableList<String> = ArrayList()
                while (matchNameAbdPass.find()) {
                    buff.add(matchNameAbdPass.group())
                }
                if (buff.size != 0) passwords.add(Password(buff[0], if (buff.size > 1) buff[1] else "None"))
            }
            return passwords
        }

    private fun readPassword(): String {
        val result = Shell.SU.run("cat /data/misc/wifi/wpa_supplicant.conf")
        return if (result.isSuccessful) {
            result.getStdout()
        } else ""
    }
}