package com.example.wifi_pentester.utils

import android.util.Log
import java.io.DataInputStream
import java.io.DataOutputStream

object RootChecker {
    @JvmStatic
    fun canRunRootCommands(): Boolean {
        var retval = false
        val suProcess: Process
        try {
            suProcess = Runtime.getRuntime().exec("su")
            val os = DataOutputStream(suProcess.outputStream)
            val osRes = DataInputStream(suProcess.inputStream)
            os.writeBytes("id\n")
            os.flush()
            val currUid = osRes.readLine()
            var exitSu = false
            if (null == currUid) {
                retval = false
                exitSu = false
                Log.d("ROOT", "Can't get root access or denied by user")
            } else if (currUid.contains("uid=0")) {
                retval = true
                exitSu = true
                Log.d("ROOT", "Root access granted")
            } else {
                retval = false
                exitSu = true
                Log.d("ROOT", "Root access rejected: $currUid")
            }
            if (exitSu) {
                os.writeBytes("exit\n")
                os.flush()
            }
        } catch (e: Exception) {
            retval = false
            Log.d("ROOT", "Root access rejected [" + e.javaClass.name + "] : " + e.message)
        }
        return retval
    }
}